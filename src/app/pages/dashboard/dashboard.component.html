<div class="page">
    <div class="title-row">
        <h3 class="page-title">{{ 'pages.dashboard.title' | translate }}</h3>
        <!-- <button type="button" class="btn btn-primary btn-circle btn-large table-btn"
            [pTooltip]="'pages.dashboard.add_indicator' | translate" tooltipPosition="left">
            <ng-icon name="phosphorPlus" size="1.5rem" />
        </button> -->
    </div>
    <div class="page-content">
        <div class="grid">
            <div class="col-12 md:col-11">
                <h3>{{ 'pages.dashboard.indicators' | translate }}</h3>
            </div>
            <div class="col-12 md:col-1 flex flex-row justify-content-end align-items-center">
                <button type="button" class="btn btn-secondary btn-circle table-btn"
                    [pTooltip]="'pages.dashboard.configure_indicator' | translate" tooltipPosition="left"
                    (click)="isIndicatorModalShown = true">
                    <ng-icon name="phosphorPencilSimple" size="1.2rem" />
                </button>
            </div>
        </div>
        <div class="cards-container" cdkDropList cdkDropListOrientation="mixed" id="selectedSection"
            [cdkDropListData]="items" (cdkDropListDropped)="onItemDrop($event)">
            <div cdkDrag *ngFor="let item of items; let index = index">
                <div class="card-buttons">
                    <button type="button" class="btn btn-default btn-circle table-btn"
                        [pTooltip]="'drag_to_reorder' | translate" [autoHide]="false" tooltipPosition="top">
                        <ng-icon cdkDragHandle name="phosphorArrowsOut" size="1.2rem" />
                    </button>
                    <button type="button" class="btn btn-default btn-circle table-btn" [pTooltip]="'delete' | translate"
                        [autoHide]="false" tooltipPosition="top" (click)="removeItem(index)">
                        <ng-icon name="phosphorTrashSimple" size="1.2rem" />
                    </button>
                </div>
                <app-dashboard-card [title]="item.examType.name" [value]="item.value" [unit]="item.examType.unit"
                    [date]="item.date" (click)="onDashboardCardClick(item)" />
            </div>
        </div>
        <div class="grid">
            <div class="col-12">
                <h3>{{ 'pages.dashboard.your_health_indicators' | translate }}</h3>
            </div>
            <div class="col-12 cards-container">
                <app-health-indicator-card *ngFor="let health_indicator of health_indicators" [indicator]="health_indicator" />
            </div>
        </div>
    </div>
</div>

<app-indicator-report #indicatorReport />

<p-dialog [(visible)]="isIndicatorModalShown" [modal]="true" [dismissableMask]="true" [draggable]="false"
    class="p-dialog-lg" (onHide)="closeIndicatorModal()">
    <ng-template pTemplate="header">
        <h1>{{ 'pages.dashboard.add_indicator' | translate }}</h1>
    </ng-template>
    <ng-template pTemplate="content">
        <form [formGroup]="indicatorForm">
            <div class="grid">
                <div class="col-12 md:col-6">
                    <div class="form-group">
                        <label for="examType">{{ 'pages.dashboard.form.select_indicator' | translate }}</label>
                        <p-dropdown [filter]="true" filterBy="nome" requiredLabel="examType" class="form-control"
                            formControlName="examType" [options]="filteredExamTypes" optionValue="_id"
                            optionLabel="name" [placeholder]="'select.placeholder' | translate" appendTo="body">
                            <ng-template pTemplate="empty">
                                <span>{{ 'select.empty' | translate }}.</span>
                            </ng-template>
                        </p-dropdown>
                        <app-error-block formControlName="examType" [show]="isSubmittedIndicatorForm" />
                    </div>
                </div>
            </div>
        </form>
    </ng-template>
    <ng-template pTemplate="footer">
        <div class="grid w100">
            <div class="col-12 md:col-6">
                <button (click)="closeIndicatorModal()" type="button" class="btn btn-default mr-auto">
                    {{ 'close' | translate }}
                </button>
            </div>
            <div class="col-12 md:col-6">
                <button (click)="addIndicator()" type="button" class="btn btn-primary ml-auto">
                    {{ 'continue' | translate }}
                </button>
            </div>
        </div>
    </ng-template>
</p-dialog>